---
title: 'Deploy Astro on AWS S3 and CloudFront'
description: 'Deploy an Astro static single page application (SPA) on AWS with S3 and CloudFront. Domains and SSL with Route53 and ACM. CI/CD from Github using CodePipeline and CodeBuild.'
---

import { Tabs, TabItem, LinkButton, Aside } from '@astrojs/starlight/components';

Deploy your [Astro](https://astro.build/) site to AWS with S3 and CloudFront for fast, reliable performance. This guide walks you through configuration and setup to get your site live with Thunder.

There are two ways to deploy your Astro static output on AWS:

1. Using the [AWS Cloud Development Kit (CDK)](https://aws.amazon.com/cdk/) with the [CDK-SPA](https://github.com/thunder-so/cdk-spa) package. Note that CDK-SPA does not support SSR.

2. Using the [Thunder console](https://console.thunder.so) to deploy your app with a few clicks.

The build artifacts (HTML, CSS and JavaScript) will be stored in an S3 bucket and served using CloudFront CDN.

<LinkButton href="https://stackblitz.com/~/github.com/cloudbitsio/astro" target="_blank" variant="secondary" icon="external">
  View code in StackBlitz
</LinkButton>

## Deploy Astro using AWS CDK
---

[CDK-SPA](https://github.com/thunder-so/cdk-spa) is a package that simplifies the deployment of static sites to AWS using the AWS Cloud Development Kit (CDK). It provides a straightforward way to deploy your Astro app to AWS S3 and CloudFront.

<Aside type="note" title="Prerequisites">
- [AWS CDK](https://aws.amazon.com/cdk/) installed. You can install it globally using npm:

```sh
npm install -g aws-cdk
```
- Node.js version 20 or higher installed on your machine.

- [AWS credentials](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html) configured on your machine and your preferred region bootstrapped with CDK.
</Aside>

### 1. Create a project

You can create a new Astro project using the following commands:

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="seti:npm">
```sh
npm create astro@latest my-astro-app
cd my-astro-app
```
  </TabItem>
  <TabItem label="pnpm" icon="pnpm">
```sh
pnpm create astro my-astro-app
cd my-astro-app
```
  </TabItem>
  <TabItem label="bun" icon="bun">
```sh
bun create astro my-astro-app
cd my-astro-app
```
  </TabItem>
</Tabs>

### 2. Configure Astro

Update your `astro.config.mjs` to generate static files:

```ts title="astro.config.mjs"
import { defineConfig } from 'astro/config';
 
export default defineConfig({
  output: 'static',
});
```

### 3. Initialize your project

Install the necessary dependencies and initialize your project:

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="seti:npm">
```sh
npm i tsx aws-cdk-lib @thunderso/cdk-spa --save-dev
```
  </TabItem>
  <TabItem label="pnpm" icon="pnpm">
```sh
pnpm add -D tsx aws-cdk-lib @thunderso/cdk-spa
```
  </TabItem>
  <TabItem label="bun" icon="bun">
```sh
bun add -d tsx aws-cdk-lib @thunderso/cdk-spa
```
  </TabItem>
</Tabs>

Create a `stack/index.ts` file. Edit it to match your project:

```ts title="stack/index.ts"
import { App } from "aws-cdk-lib";
import { SPAStack, type SPAProps } from "@thunderso/cdk-spa";

const myApp: SPAProps = {
  env: {
    account: 'your-account-id',
    region: 'us-east-1'
  },
  application: 'your-application-id',
  service: 'your-service-id',
  environment: 'production',

  rootDir: '', // e.g. 'frontend/' for monorepos
  outputDir: 'dist/',
};

new SPAStack(
  new App(), 
  `${myApp.application}-${myApp.service}-${myApp.environment}-stack`, 
  myApp
);
```

### 4. Deploy

Before you deploy, run your build script to generate artifacts in the `dist` directory.

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="seti:npm">
```sh
npm run astro check && npm run astro build
```
  </TabItem>
  <TabItem label="pnpm" icon="pnpm">
```sh
pnpm run astro check && pnpm run astro build
```
  </TabItem>
  <TabItem label="bun" icon="bun">
```sh
bun run astro check && bun run astro build
```
  </TabItem>
</Tabs>

By running the following script, the CDK stack will be deployed to AWS.

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="seti:npm">
```sh
npx cdk deploy --all --app="npx tsx stack/index.ts"
```
  </TabItem>
  <TabItem label="pnpm" icon="pnpm">
```sh
pnpm exec cdk deploy --all --app="pnpm exec tsx stack/index.ts"
```
  </TabItem>
  <TabItem label="bun" icon="bun">
```sh
npx cdk deploy --all --app="bunx tsx stack/index.ts"
```
  </TabItem>
</Tabs>

When the deployment is complete, you will see the CloudFront URL in the output. You can access your Astro app at that URL.

For complete documentation on how to use CDK-SPA, refer to the [CDK-SPA documentation](https://github.com/thunderso/cdk-spa).


## Deploy using Thunder console
---

You can also deploy your Astro app on AWS using the [Thunder console](https://console.thunder.so).

<Aside type="note" title="Prerequisites">
- An [AWS account](/docs/aws) added to your organization.
- A [GitHub account](/docs/github) connected to your organization.
- [Import GitHub repository](/docs/import-repository) with your Astro app code.
</Aside>


### Build Settings

Use the following commands in the build step settings:

<Tabs syncKey="package-manager">
  <TabItem label="npm" icon="seti:npm">
```sh title="Install command"
npm install
```
```sh title="Build command"
npm run astro check && npm run astro build
```
```sh title="Output directory"
dist
```
  </TabItem>
  <TabItem label="pnpm" icon="pnpm">
```sh title="Install command"
npx pnpm install
```
```sh title="Build command"
npx pnpm run astro check && npx pnpm run astro build
```
```sh title="Output directory"
dist
```
  </TabItem>
  <TabItem label="bun" icon="bun">
```sh title="Install command"
npx bun install
```
```sh title="Build command"
npx bun run astro check && npx bun run astro build
```
```sh title="Output directory"
dist
```
  </TabItem>
</Tabs>

Thatâ€™s it! Your app will be live on your CloudFront URL as soon as the stack is installed.

## Environment Variables

Astro allows you to define and use environment variables during the build step in a type-safe manner as a string, number, enum, or boolean using the envField helper. 

Define your environment variables in the Thunder console under the [Environment Variables](/docs/environment-variables) section of your project settings.

*Context*: Since you're building an SPA, set the context to <code>client</code>, as these variables will be used in the browser.

*Access*: Use <code>public</code> access for these variables. Never store secret keys or sensitive information in public variables, as they will be exposed in the browser and accessible to anyone.

Additional Properties: You can specify properties like *optional* or *default* in the object, but always ensure sensitive information is not included.

```ts title="astro.config.mjs"
import { defineConfig, envField } from 'astro/config';

export default defineConfig({
	env: {
		schema: {
			CLIENT_API_URL: envField.string({ 
        context: "client",
        access: "public", 
        default: "my-api-url"
      }),
      CLIENT_SECRET: envField.string({ 
        context: "client", 
        access: "public", 
        optional: false 
      }),
		}
	}

  /** */
});
```

To access these in your Astro components:

```ts title="index.astro"
---
import { CLIENT_API_URL, CLIENT_SECRET } from "astro:env/client";

const data = await fetch(`${CLIENT_API_URL}/api`, {
  headers: {
    Authorization: `Bearer ${CLIENT_SECRET}`
  }
})
---
```