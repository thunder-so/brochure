---
title: Single Page Applications (SPA)
description: Deploy SPAs using S3 and CloudFront
---
import { Icon } from 'astro-icon/components';

## Hosting Architecture

The hosting architecture provides a globally distributed, secure, and performant infrastructure for serving static web applications.

<section class="max-w-full bg-card border border-border rounded-lg p-6 mb-6">
  <svg viewBox="0 0 720 120" class="w-full h-auto">
    <line x1="120" y1="60" x2="200" y2="60" stroke="currentColor" class="text-border" />
    <line x1="320" y1="60" x2="400" y2="60" stroke="currentColor" class="text-border" />
    <line x1="520" y1="60" x2="600" y2="60" stroke="currentColor" class="text-border" />
    
    <foreignObject x="0" y="30" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-8 h-8 text-gray-600">
          <Icon name="tabler:users" class="text-muted-foreground w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">Users</span>
      </div>
    </foreignObject>
    
    <foreignObject x="200" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12 text-orange-500">
          <Icon name="logos:aws-route53" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">Route 53</span>
      </div>
    </foreignObject>
    
    <foreignObject x="400" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12 text-purple-500">
          <Icon name="logos:aws-cloudfront" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CloudFront</span>
      </div>
    </foreignObject>
    
    <foreignObject x="600" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12 text-green-600">
          <Icon name="logos:aws-s3" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">S3</span>
      </div>
    </foreignObject>
  </svg>
</section>

**Route 53** handles DNS resolution, directing users to the nearest CloudFront edge location. **CloudFront** serves as a global CDN, caching static assets at edge locations worldwide for low-latency delivery. **S3** stores the application files as the origin, providing durable and scalable object storage.

## CI/CD Pipeline Architecture

The pipeline architecture automates the build and deployment process, ensuring consistent and reliable deployments from source code to production.

<section class="max-w-full bg-card border border-border rounded-lg p-6 mb-6">
  <svg viewBox="0 0 720 260" class="w-full h-auto">
    <line x1="120" y1="60" x2="200" y2="60" stroke="currentColor" class="text-border" />
    <line x1="320" y1="60" x2="400" y2="60" stroke="currentColor" class="text-border" />
    <line x1="520" y1="60" x2="600" y2="60" stroke="currentColor" class="text-border" />
    <line x1="460" y1="120" x2="460" y2="160" stroke="currentColor" class="text-border" />
    
    <foreignObject x="0" y="30" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-8 h-8">
          <Icon name="tabler:brand-github" class="text-muted-foreground w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">GitHub</span>
      </div>
    </foreignObject>
    
    <foreignObject x="200" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codepipeline" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodePipeline</span>
      </div>
    </foreignObject>
    
    <foreignObject x="400" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codebuild" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodeBuild</span>
      </div>
    </foreignObject>

    <foreignObject x="600" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-s3" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">S3</span>
      </div>
    </foreignObject>
    
    <foreignObject x="400" y="180" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-cloudfront" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CloudFront</span>
      </div>
    </foreignObject>
  </svg>
</section>

**GitHub** triggers the pipeline on code changes. **CodePipeline** orchestrates the deployment workflow, while **CodeBuild** executes the build process in a managed environment. Built assets are uploaded to **S3** and **CloudFront** cache is invalidated to serve the latest version.

## Quick Start

### Installation

```bash
bun add -D tsx aws-cdk-lib @thunderso/cdk-spa
```

### Basic Setup

```bash
bunx cdk-spa-init
```

### Configuration

```ts
// stack/index.ts
import { Cdk, SPAStack, type SPAProps } from "@thunderso/cdk-spa";

const stackProps: SPAProps = {
  env: {
    account: 'your-account-id',
    region: 'us-east-1'
  },
  application: 'my-app',
  service: 'frontend',
  environment: 'production',
  outputDir: 'dist/',
};

new SPAStack(
  new Cdk.App(), 
  `${stackProps.application}-${stackProps.service}-${stackProps.environment}-stack`, 
  stackProps
);
```

### Deploy

```bash
bunx cdk deploy --all --app="bunx tsx stack/index.ts"
```

## Custom Domain Setup

```ts
const stackProps: SPAProps = {
  // ... other props
  domain: 'app.example.com',
  hostedZoneId: 'Z1D633PJN98FT9',
  globalCertificateArn: 'arn:aws:acm:us-east-1:123456789012:certificate/abcd1234-abcd-1234-abcd-1234abcd1234',
};
```

## Advanced Features

### URL Redirects and Rewrites

```ts
const stackProps: SPAProps = {
  // ... other props
  redirects: [
    { source: '/home', destination: '/' },
    { source: '/blog/:slug', destination: '/posts/:slug' }
  ],
  rewrites: [
    { source: '/app/*', destination: '/index.html' }
  ],
};
```

### Custom Headers

```ts
const stackProps: SPAProps = {
  // ... other props
  headers: [
    {
      path: '/*',
      name: 'Cache-Control',
      value: 'public, max-age=31536000'
    }
  ],
};
```

### AWS CodePipeline Integration

```ts
const stackProps: SPAProps = {
  // ... other props
  githubAccessTokenArn: 'arn:aws:secretsmanager:us-east-1:123456789012:secret:github-token-XXXXXX',
  sourceProps: {
    owner: 'your-username',
    repo: 'your-repo',
    branchOrRef: 'main',
  },
  buildProps: {
    runtime: 'nodejs',
    runtime_version: '20',
    installcmd: 'bun install',
    buildcmd: 'bun run build',
  },
};
```