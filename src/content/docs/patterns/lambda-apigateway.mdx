---
title: Serverless Functions
description: Deploy serverless functions using AWS Lambda and API Gateway
---
import { Icon } from 'astro-icon/components';
import ServerlessAPIArchitecture from '@/components/docs/patterns/ServerlessAPIArchitecture.astro';

Deploy serverless APIs and backend functions on AWS Lambda with modern web frameworks like Express.js, Hono, NestJS, and Fastify.

Thunder provides the [@thunderso/cdk-functions](https://github.com/thunder-so/cdk-functions) package for deploying Lambda functions with API Gateway, supporting both standard zip deployments and container images for custom runtimes.

## Supported Frameworks

- [Hono](https://hono.dev/)
- [NestJS](https://nestjs.com/)
- [Fastify](https://www.fastify.io/)
- [Koa](https://koajs.com/)
- [AdonisJS](https://adonisjs.com/)
- [Sails.js](https://sailsjs.com/)
- [LoopBack](https://loopback.io/)
- [Feathers](https://feathersjs.com/)
- [Restify](http://restify.com/)
- Any web application framework

## Serverless API Architecture

The serverless architecture provides scalable, event-driven compute for APIs without managing servers.

<ServerlessAPIArchitecture />

## Zip Deployment Pipeline

The zip deployment pipeline packages and deploys lightweight Lambda functions for standard use cases.

<section class="max-w-full bg-card border border-border rounded-lg p-6 mb-6">
  <svg viewBox="0 0 720 120" class="w-full h-auto">
    <line x1="120" y1="60" x2="200" y2="60" stroke="currentColor" class="text-border" />
    <line x1="320" y1="60" x2="400" y2="60" stroke="currentColor" class="text-border" />
    <line x1="520" y1="60" x2="600" y2="60" stroke="currentColor" class="text-border" />
    
    <foreignObject x="0" y="30" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-8 h-8">
          <Icon name="tabler:brand-github" class="text-muted-foreground w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">GitHub</span>
      </div>
    </foreignObject>
    
    <foreignObject x="200" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codepipeline" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodePipeline</span>
      </div>
    </foreignObject>
    
    <foreignObject x="400" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codebuild" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodeBuild</span>
      </div>
    </foreignObject>
    
    <foreignObject x="600" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12 text-orange-600">
          <Icon name="logos:aws-lambda" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">Lambda</span>
      </div>
    </foreignObject>
  </svg>
</section>

**GitHub** triggers deployments on code changes. **CodePipeline** orchestrates the workflow while **CodeBuild** packages the function code into a zip file and deploys directly to **Lambda**.

## Container Deployment Pipeline

The container deployment pipeline builds custom runtime environments for advanced use cases and larger dependencies.

<section class="max-w-full bg-card border border-border rounded-lg p-6 mb-6">
  <svg viewBox="0 0 720 260" class="w-full h-auto">
    <line x1="120" y1="60" x2="200" y2="60" stroke="currentColor" class="text-border" />
    <line x1="320" y1="60" x2="400" y2="60" stroke="currentColor" class="text-border" />
    <line x1="520" y1="60" x2="600" y2="60" stroke="currentColor" class="text-border" />
    <line x1="660" y1="120" x2="660" y2="160" stroke="currentColor" class="text-border" />
    
    <foreignObject x="0" y="30" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-8 h-8">
          <Icon name="tabler:brand-github" class="text-muted-foreground w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">GitHub</span>
      </div>
    </foreignObject>
    
    <foreignObject x="200" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codepipeline" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodePipeline</span>
      </div>
    </foreignObject>
    
    <foreignObject x="400" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">
          <Icon name="logos:aws-codebuild" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">CodeBuild</span>
      </div>
    </foreignObject>
    
    <foreignObject x="600" y="20" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12">          
            <svg class="w-full h-full" viewBox="0 0 80 80">
                <defs>
                    <linearGradient x1="0%" y1="100%" x2="100%" y2="0%" id="linearGradient-1">
                        <stop stop-color="#C8511B" offset="0%"></stop>
                        <stop stop-color="#FF9900" offset="100%"></stop>
                    </linearGradient>
                </defs>
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <rect fill="url(#linearGradient-1)" x="0" y="0" width="80" height="80"></rect>
                    <path d="M38.7880741,37.5776945 C38.2933845,37.8655125 37.9855777,38.4000317 37.9855777,38.973662 L37.9855777,66.7195186 L16.9987459,54.9841655 L16.9987459,27.7076428 L40.5569643,14.0588515 L61.484833,24.4283226 L38.7880741,37.5776945 Z M63.9203049,24.4022485 C63.9203049,23.8276153 63.6134974,23.2920933 63.0598448,22.9751927 L41.3464689,12.2146099 C40.8507799,11.9287976 40.2351662,11.9277948 39.7404766,12.2156128 L15.8024965,26.0840283 C15.3078069,26.3718463 15,26.9063655 15,27.4799958 L15,55.2158239 C15,55.7894542 15.3078069,56.3239734 15.8174871,56.6198142 L37.573836,68.7853901 C37.8216805,68.9287976 38.1005056,69 38.3783312,69 C38.6551575,69 38.9339826,68.9287976 39.1808277,68.7853901 C39.6765167,68.4985749 39.9843236,67.9640557 39.9843236,67.3894226 L39.9843236,39.201309 L63.1178084,25.798216 C63.6134974,25.5114008 63.9203049,24.9768817 63.9203049,24.4022485 L63.9203049,24.4022485 Z M63.9692742,55.0473451 L44.9811883,66.6613533 L44.9811883,56.2617967 L54.881976,49.872638 L54.9499334,49.424364 C54.9679221,49.3070305 54.9749177,49.3070305 54.9749177,48.7664942 L55.0058983,36.3602344 L64.0002547,31.1484218 L63.9692742,55.0473451 Z M65.1965042,29.0715191 C64.6998158,28.7816953 64.0842021,28.7826982 63.5885131,29.0715191 L54.0135209,34.6182835 C53.713709,34.7817481 53.0081517,35.1658398 53.0081517,35.9580914 L52.9761718,48.7173546 L43.8508975,54.606091 C43.3062392,54.9310145 42.9824424,55.4454766 42.9824424,55.9890214 L42.9824424,67.3081917 C42.9824424,67.8748021 43.2872511,68.3912699 43.7979307,68.6871107 C44.0647633,68.8405468 44.361577,68.9187691 44.6573914,68.9187691 C44.948209,68.9187691 45.2390265,68.8445582 45.5018616,68.692125 L65.1675223,56.6639396 C65.6622119,56.3761216 65.9680201,55.8416024 65.9680201,55.2709807 L66,30.4664837 C66,29.8928534 65.6921931,29.3583342 65.1965042,29.0715191 L65.1965042,29.0715191 Z" fill="#FFFFFF"></path>
                </g>
            </svg>
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">ECR</span>
      </div>
    </foreignObject>
    
    <foreignObject x="600" y="180" width="120" height="80">
      <div class="flex flex-col items-center text-center">
        <div class="w-12 h-12 text-orange-600">
          <Icon name="logos:aws-lambda" class="w-full h-full" />
        </div>
        <span class="mt-2 text-sm font-medium text-muted-foreground">Lambda</span>
      </div>
    </foreignObject>
  </svg>
</section>

**GitHub** triggers deployments. **CodeBuild** builds Docker images with custom runtimes, pushes to **ECR**, then deploys container images to **Lambda** for advanced use cases requiring custom dependencies or alternative runtimes like Bun.

## Quick Start

Get your serverless API deployed to AWS Lambda in minutes. This guide covers installation, basic configuration, and deployment.

### Installation

```bash
bun add -D tsx @thunderso/cdk-functions
```

### Basic Setup

```bash
mkdir stack && touch stack/index.ts
```

### Configuration

```ts
// stack/index.ts
import { Cdk, FunctionStack, type FunctionProps } from '@thunderso/cdk-functions';

const fnProps: FunctionProps = {
  env: {
    account: 'your-account-id',
    region: 'us-east-1',
  },
  application: 'my-api',
  service: 'backend',
  environment: 'production',
  functionProps: {
    codeDir: 'dist/',
    handler: 'index.handler',
  },
};

new FunctionStack(
  new Cdk.App(), 
  `${fnProps.application}-${fnProps.service}-${fnProps.environment}-stack`, 
  fnProps
);
```

### Deploy

```bash
bunx cdk deploy --all --app="bunx tsx stack/index.ts"
```

## Custom Domain Setup

Connect your API to a custom domain using Route 53 and ACM certificates. The certificate must be issued in the same region as your Lambda function.

```ts
const fnProps: FunctionProps = {
  // ... other props
  domain: 'api.example.com',
  hostedZoneId: 'Z1D633PJN98FT9',
  regionalCertificateArn: 'arn:aws:acm:us-east-1:123456789012:certificate/abcd1234-abcd-1234-abcd-1234abcd1234',
};
```

## Advanced Configuration

### Lambda Settings

Fine-tune your function's performance with runtime selection, memory allocation, timeout configuration, and ARM64 architecture support for better price-performance.

```ts
import { Runtime, Architecture } from 'aws-cdk-lib/aws-lambda';

const fnProps: FunctionProps = {
  // ... other props
  functionProps: {
    runtime: Runtime.NODEJS_20_X,
    architecture: Architecture.ARM_64,
    memorySize: 1792,
    timeout: 10,
    tracing: true,
    keepWarm: true,
  },
};
```

### Environment Variables

Manage configuration with plain environment variables and secure secrets from AWS Secrets Manager. The library automatically grants Lambda permissions to read specified secrets.

```ts
const fnProps: FunctionProps = {
  // ... other props
  functionProps: {
    variables: [
      { API_URL: 'https://api.example.com' },
      { NODE_ENV: 'production' }
    ],
    secrets: [
      { 
        key: 'DATABASE_URL', 
        resource: 'arn:aws:secretsmanager:us-east-1:123456789012:secret:db-url-abc123' 
      }
    ],
  }
};
```

## Container Deployments

Deploy Lambda functions as container images to use custom runtimes, package large dependencies, or run alternative runtimes like Bun. Container images support up to 10GB compared to the 250MB zip limit.

### Node.js Container

Use the official AWS Lambda Node.js base image for standard Node.js deployments with custom dependencies or build processes.

```dockerfile
# Dockerfile.node
FROM public.ecr.aws/lambda/nodejs:22 AS base
WORKDIR ${LAMBDA_TASK_ROOT}

COPY . .
RUN bun install --production
RUN bun run build

FROM public.ecr.aws/lambda/nodejs:22
WORKDIR ${LAMBDA_TASK_ROOT}

COPY --from=base /var/task/dist/* ./
COPY --from=base /var/task/node_modules node_modules

CMD [ "index.handler" ]
```

```ts
const fnProps: FunctionProps = {
  // ... other props
  functionProps: {
    dockerFile: 'Dockerfile.node',
  },
};
```

### Bun Runtime Container

Deploy Lambda functions using the Bun runtime for faster cold starts and improved performance. Requires a fetch-compatible handler that matches the Fetch API standard.

```dockerfile
# Dockerfile.bun
FROM oven/bun:latest AS base
WORKDIR /tmp

COPY . .
RUN bun install
RUN bun run build

FROM public.ecr.aws/lambda/provided:al2023
WORKDIR ${LAMBDA_TASK_ROOT}

COPY --from=base /tmp/dist/* ./
COPY --from=base /tmp/node_modules node_modules

CMD [ "lambda-bun.fetch" ]
```

```ts
const fnProps: FunctionProps = {
  // ... other props
  functionProps: {
    dockerFile: 'Dockerfile.bun',
  },
};
```