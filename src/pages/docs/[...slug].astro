---
import { type CollectionEntry, getCollection } from 'astro:content'
import DocsLayout from '../../layouts/DocsLayout.astro'
import fs from 'fs'
import path from 'path'

export async function getStaticPaths() {
  const docs = await getCollection('docs')
  const paths = [] as any[]
  
  // Regular docs pages
  docs.forEach((entry) => {
    paths.push({
      params: { slug: entry.slug },
      props: { entry, isMarkdown: false }
    })
    
    // Markdown view pages
    paths.push({
      params: { slug: `${entry.slug}.md` },
      props: { entry, isMarkdown: true }
    })
  })
  
  return paths
}

const { entry, isMarkdown } = Astro.props

if (isMarkdown) {
  // Read raw file content for markdown view
  const filePath = path.join(process.cwd(), 'src/content/docs', `${entry.slug}.mdx`)
  let rawContent = ''
  try {
    rawContent = fs.readFileSync(filePath, 'utf-8')
  } catch (e) {
    rawContent = 'File not found'
  }
  
  return new Response(rawContent, {
    headers: { 'Content-Type': 'text/plain; charset=utf-8' }
  })
}

const { Content, headings } = await entry.render()
// console.log("post", post.data);
// console.log("Content", Content);
// console.log("headings", headings);

export const prerender = true;
---

<DocsLayout headings={headings} {...entry.data}>
  <Content />
</DocsLayout>
